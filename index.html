<!-- File: index.html -->
<!-- MIT License — https://github.com/AllieBaig/WordAtlas/blob/main/LICENSE -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WordAtlas</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles/main.css" />
  <link rel="icon" href="icons/icon-192.png" type="image/png" />
  <meta name="theme-color" content="#0055aa" />
</head>

<body>
  <!-- Header -->
  <header>
    <h1>WordAtlas</h1>
    <p>Select a mode to begin</p>
  </header>

  <!-- Main Menu -->
  <main id="menu" class="active">
    <section class="mode-buttons">
      <button class="menu-btn" data-mode="regular">🧠 Solo Mode</button>
      <button class="menu-btn" data-mode="wordRelic">🏺 Word Relic</button>
      <button class="menu-btn" data-mode="wordSafari">🦁 Word Safari</button>
      <button class="menu-btn" data-mode="dice">🎲 Dice Challenge</button>
      <button class="menu-btn" data-mode="atlas">🗺️ Word Atlas</button>
      <button class="menu-btn" data-mode="trail">🪄 Trail of Letters</button>
      <button class="menu-btn" data-mode="versus">🤖 Play vs Computer</button>
      <button class="menu-btn" data-mode="nearby">📍 Play Nearby</button>
    </section>
  </main>

  <!-- Game Area -->
  <section id="game" class="game-container"></section>

  <!-- Footer -->
  <footer style="text-align:center; font-size:0.85rem; margin-top:2rem;">
    <span id="verInfo" style="font-weight:bold; padding:0.3rem 0.6rem; border-radius:6px;"></span> |
    <a href="scripts/utils/error-log.html" target="_blank">🐞 Error Log</a>
  </footer>

  <!-- Version Toggle (Debug Only) -->
  <button id="versionToggleBtn" style="display:none; position: fixed; bottom: 1rem; right: 1rem;">
    Toggle Version
  </button>

  <!-- Dynamic Loader -->
  <script type="module">
    const versionKey = 'wordatlas-version';
    const version = localStorage.getItem(versionKey) || 'v-latest';

    const roots = {
      'v-latest': './scripts/',
      'v-site1': './Site1/scripts/',
      'v-dev': './Site2/scripts/'
    };
    const root = roots[version] || './scripts/';

    async function loadSafe(file) {
      try {
        await import(root + file);
        console.log(`✅ Loaded ${file} from ${version}`);
      } catch (err) {
        console.error(`❌ Failed: ${file} from ${version}`, err);
      }
    }

    loadSafe('main.js');
    loadSafe('gameNavigation.js');

    const verBox = document.getElementById('verInfo');
    verBox.textContent = `Mode: ${version}`;
    verBox.style.background = {
      'v-latest': '#2d8fdd',
      'v-site1': '#888',
      'v-dev': '#e97a00'
    }[version] || '#444';
    verBox.style.color = '#fff';

    if (location.search.includes('debug')) {
      document.getElementById('versionToggleBtn').style.display = 'block';
    }

    document.getElementById('versionToggleBtn')?.addEventListener('click', () => {
      const current = localStorage.getItem(versionKey) || 'v-latest';
      const next = current === 'v-latest' ? 'v-site1' : current === 'v-site1' ? 'v-dev' : 'v-latest';
      localStorage.setItem(versionKey, next);
      alert(`🔁 Switched to ${next}. Reloading...`);
      location.reload();
    });
  </script>

  <!-- PWA Registration -->
  <script src="scripts/serviceWorkerRegistration.js"></script>
</body>
</html>
