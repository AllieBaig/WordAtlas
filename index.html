<!-- MIT License ‚Äì AllieBaig ‚Äì https://github.com/AllieBaig/naptpwa/blob/main/LICENSE -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#0055aa" />
  <meta name="description" content="NAPT Word Game ‚Äì Modular, Offline, Multi-mode PWA" />
  <title>NAPT Word Game</title>

  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png" type="image/png" />
  <link rel="stylesheet" href="styles/main.css" />
  <link href="https://fonts.googleapis.com/css2?family=Domine&family=Merriweather&family=Tinos&family=Lora&display=swap" rel="stylesheet" />

  <!-- Theme & Font Settings -->
  <script>
    const root = document.documentElement;
    const font = localStorage.getItem('napt-font');
    const theme = localStorage.getItem('napt-theme');
    const contrast = localStorage.getItem('napt-contrast');
    const useEmojis = localStorage.getItem('napt-use-emojis');

    if (font) root.classList.add(`font-${font}`);
    if (theme === 'dark') root.classList.add('theme-dark');
    if (contrast === 'true') root.classList.add('theme-high-contrast');
    if (useEmojis === 'false') root.classList.add('no-emojis');
  </script>
</head>

<body>
  <header>
    <h1>NAPT Word Game</h1>
    <p>Select a game mode to begin</p>
  </header>

  <main id="menu" class="active">
    <section class="mode-buttons">
      <button class="menu-btn" data-mode="regular">üß† Solo Mode</button>
      <button class="menu-btn" data-mode="wordRelic">üè∫ Word Relic</button>
      <button class="menu-btn" data-mode="wordSafari">ü¶Å Word Safari</button>
      <button class="menu-btn" data-mode="dice">üé≤ Dice Challenge</button>
      <button class="menu-btn" data-mode="atlas">üó∫Ô∏è Word Atlas</button>
      <button class="menu-btn" data-mode="trail">ü™Ñ Trail of Letters</button>
      <button class="menu-btn" data-mode="versus">ü§ñ Play vs Computer</button>
      <button class="menu-btn" data-mode="nearby">üìç Play Nearby</button>
    </section>

    <details id="settings-panel">
      <summary><strong>‚öôÔ∏è Settings</strong></summary>
      <div class="settings-group">
        <label>Font
          <select id="fontSelector">
            <option value="">System Default</option>
            <option value="domine">Domine</option>
            <option value="merriweather">Merriweather</option>
            <option value="lora">Lora</option>
            <option value="tinos">Tinos</option>
          </select>
        </label>
        <label>Theme
          <select id="themeSelector">
            <option value="system">System</option>
            <option value="light">Light</option>
            <option value="dark">Dark</option>
          </select>
        </label>
        <label><input type="checkbox" id="highContrastToggle" /> High Contrast</label>
        <label><input type="checkbox" id="emojiToggle" checked /> Show Emojis</label>
        <label><input type="checkbox" id="resumeToggle" /> Resume Last Game</label>
        <label>Difficulty
          <select id="difficultySelector">
            <option value="easy" selected>Easy</option>
            <option value="medium">Medium</option>
            <option value="hard">Hard</option>
          </select>
        </label>
        <label>Nearby Radius
          <select id="radiusSelector">
            <option value="3">3 km</option>
            <option value="10" selected>10 km</option>
            <option value="25">25 km</option>
            <option value="50">50 km</option>
          </select>
        </label>
        <label>
          <input type="checkbox" id="useSite2Toggle" />
          Force fallback to Site2 scripts
        </label>
      </div>
    </details>
  </main>

  <section id="game" class="game-container"></section>

  <footer>
    <a href="scripts/utils/error-log.html" target="_blank">üêû View Error Log</a>
  </footer>

  <!-- Smart script loader with fallback -->
  <script type="module">
    const useSite2 = localStorage.getItem('napt-use-site2') === 'true';
    const primary = './scripts/';
    const fallback = './Site1/scripts/';
    const files = ['main.js', 'gameNavigation.js'];

    for (const file of files) {
      const path = useSite2 ? fallback : primary;
      try {
        await import(path + file);
        console.log(`‚úÖ Loaded: ${file} from ${path}`);
      } catch (err) {
        console.warn(`‚ö†Ô∏è Failed loading ${file} from ${path}. Retrying fallback...`);
        if (!useSite2) {
          try {
            await import(fallback + file);
            console.log(`‚úÖ Fallback loaded: ${file}`);
          } catch {
            console.error(`‚ùå Could not load ${file} from fallback either.`);
          }
        }
      }
    }
  </script>

  <!-- Fallback toggle handler -->
  <script>
    const fallbackToggle = document.getElementById('useSite2Toggle');
    if (fallbackToggle) {
      fallbackToggle.checked = localStorage.getItem('napt-use-site2') === 'true';
      fallbackToggle.addEventListener('change', e => {
        localStorage.setItem('napt-use-site2', e.target.checked);
        location.reload();
      });
    }
  </script>

  <script src="scripts/serviceWorkerRegistration.js"></script>
</body>
</html>